#!/bin/bash

# 파일 경로가 인수로 제공되었는지 확인합니다.
if [ -z "$1" ]; then
  echo "사용법: ./clean_markdown.sh <마크다운_파일_경로>"
  exit 1
fi

FILE_PATH="$1"

# 파일이 존재하는지 확인합니다.
if [ ! -f "$FILE_PATH" ]; then
  echo "오류: '$FILE_PATH' 파일을 찾을 수 없습니다."
  exit 1
fi

# 임시 파일을 생성하여 중간 변경 사항을 저장합니다.
TMP_FILE=$(mktemp)

# 1. 번역 청크 마커, 페이지 번호, 구분선을 제거합니다.
# sed를 사용하여 패턴에 맞는 줄을 찾아 제거하거나 내용을 바꿉니다.
sed -e 's/# --- 번역된 청크 시작 ---//g' \
    -e 's/# --- 번역된 청크 끝 (일관성 유지됨) ---//g' \
    -e '/^---\s*$/d' \
    -e '/^[\s]*[0-9]\+\s*$/d' \
    -e '/^##\s*[\s]*[0-9]\+\s*$/d' \
    -e '/^\[\s*[0-9]\+\s*\]\s*$/d' \
    -e '/^##\s*\[\s*[0-9]\+\s*\]\s*$/d' \
    "$FILE_PATH" > "$TMP_FILE"

# 2. 연속된 여러 개의 빈 줄을 최대 2개로 줄입니다.
# awk를 사용하여 빈 줄의 개수를 세고, 3개 이상 연속될 경우 출력하지 않습니다.
awk 'BEGIN { n = 0 } /^$/ { n++ } !/^$/ { n = 0 } n < 3' "$TMP_FILE" > "$FILE_PATH"

# 3. 임시 파일을 삭제합니다.
rm "$TMP_FILE"

echo "'$FILE_PATH' 파일 정리가 완료되었습니다."

